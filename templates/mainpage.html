<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <title>중고세상</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <link
            href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap"
            rel="stylesheet"
    />

    <style>
        .nav-bar {
            width: 100%;
            height: 60px;

            margin: 5px;

            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            margin: 15px;
            font-size: 40px;
        }

        .nav-bar .menu {
            margin-right: 10px;
        }

        .menu > button {
            background-color: transparent;
            border: transparent;
            font-size: 20px;
        }

        .menu > button:hover {
            text-decoration: underline;
            text-underline-position: under;
        }

        .mytitle {
            width: 100%;
            height: 250px;

            background-image: linear-gradient(
                    0deg,
                    rgba(0, 0, 0, 0.5),
                    rgba(0, 0, 0, 0.5)
            ),
            url("https://www.opinionnews.co.kr/news/photo/202208/72246_53376_4150.png");
            background-position: center;
            background-size: cover;

            color: white;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }


        .nav-search {

            display: flex;
            justify-content: end;
            width: 100%;
            height: 55px;

        }

        .search {
            margin: 10px;
            display: flex;
            align-items: center;

            border-bottom: 1px solid black;

        }

        .search-input {
            border: none;
            border-radius: 5px;

            margin-right: 3px;
        }

        .search-button {
            border: transparent;
            border-radius: 5px;

            background-color: transparent;
            font-size: 17px;
        }

        .search-button:hover {
            text-decoration: underline;
            text-underline-position: under;
        }

        .mycards {
            margin: 20px auto 0 auto;
            width: 95%;
            max-width: 1200px;
        }


        .modal-content {
            width: 100%;
            max-width: 1000px;


            /* 모달창 가운데 정렬 */
            position: fixed;

            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);

        }
    </style>
    <script>


        $(document).ready(function () {
            listing()
        })

        {#DB 값 가져오기#}

        function listing() {
            $.ajax({
                type: "GET",
                url: "/api/postlist",
                data: {},
                success: function (response) {
                    load_post(response)
                }
            })
        }


        {# 검색 기능 함수 #}

        function search_event() {
            search_val = $('#searchKwd').val()
            $('#noresult').remove()
            $('#posts-box').empty()
            $.ajax({
                type: "get",
                url: "/api/postlist",
                data: {filter: search_val},
                success: function (response) {
                    let posts = response['all_posts']
                    if (posts.length < 1) {
                        temp_html = `
                            <h1 class="card-title" id="noresult">결과가 없습니다</h1>
                        `
                        $('.mycards').append(temp_html)
                    }
                    load_post(response)
                }
            })
        }

        function load_post(response) {
            let posts = response['all_posts']
            for (let i = 0; i < posts.length; i++) {
                let title = posts[i]['title']
                let img = posts[i]['img']
                let contact = posts[i]['contact']
                let amount = posts[i]['amount']

                let temp_html = `
                        <div class="col">
                            <div class="card h-100">
                                <img
                                        src="../static/image/${img}"
                                        class="card-img-top"
                                        onerror="this.onerror=null; this.src='../static/image/null.png';"
                                        alt=""
                                />
                                <div class="card-body">
                                    <h5 class="card-title">${title}</h5>
                                    <p class="card-text">가격: ${amount}₩</p>
                                    <p class="card-text">연락처: ${contact}</p>
                                </div>
                            </div>
                        </div>
                        `

                $('#posts-box').append(temp_html)
            }
        }


        {# 전화번호 자동으로 '-' 채워주는 함수#}
        const telHyphen = (target) => {
            target.value = target.value
                .replace(/[^0-9]/g, '')
                .replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/g, "$1-$2-$3").replace(/(-{1,2})$/g, "");
        }

        {# 이미지 업로드 시 미리보기 #}

        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#preimg').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }


        function modal_reset() {
            $('input').val("");
            $('textarea').val("");
            $('select').val('지역 선택');
        }
    </script>


</head>

<body>
<header>
    <div class="nav-bar">
        <h3 class="logo">중고세상</h3>

        <!-- menu -->
        <div class="menu">
            <!-- Button trigger modal -->
            <button type="button" class="btn-modal" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                글쓰기
            </button>
            <button class="btn-logout">로그아웃</button>
        </div>
    </div>
</header>

<div class="modal " id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">상품 등록</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="modal-form" action="/api/newpost" method="POST" enctype="multipart/form-data">
                    <div class="container-md border border-dark rounded-3 mt-3 bg-light">
                        <div class="container text-center mt-3">
                            <div class="row">
                                <div class="col">
                                    <img
                                            id="preimg"
                                            class="image rounded mx-auto d-block border border-dark mb-3"
                                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSkLYsNPFKvw3kqvvdQpL5QHnP5rq371aksTtt15ppO&s"
                                            alt=""
                                            style="height: 280px"
                                    />
                                    <div class="input-group">
                                        <input
                                                name="img"
                                                required
                                                type="file"
                                                accept="image/*"
                                                class="form-control"
                                                onchange="readURL(this)"
                                        />
                                    </div>
                                </div>
                                <div class="col mt-3">
                                    <select
                                            name="area"
                                            required
                                            class="form-select form-select-lg mb-5"
                                            aria-label=".form-select-lg example"
                                    >
                                        <option selected value="0">지역 선택</option>
                                        <option value="1">서울특별시</option>
                                        <option value="2">경기도</option>
                                        <option value="3">인천광역시</option>
                                        <option value="4">대전광역시</option>
                                        <option value="5">광주광역시</option>
                                        <option value="6">대구광역시</option>
                                        <option value="7">울산광역시</option>
                                        <option value="8">부산광역시</option>
                                        <option value="9">강원도</option>
                                        <option value="10">충청북도</option>
                                        <option value="11">충청남도</option>
                                        <option value="12">전라북도</option>
                                        <option value="13">전라남도</option>
                                        <option value="14">경상북도</option>
                                        <option value="15">경상남도</option>
                                        <option value="16">제주도</option>
                                    </select>
                                    <div class="input-group mb-5">
                                        <label class="input-group-text" for="title">제목</label>
                                        <input
                                                id="title"
                                                name="title"
                                                type="text"
                                                class="form-control"
                                                placeholder="제목"
                                        />
                                    </div>
                                    <div class="input-group mb-5">
                                        <label class="input-group-text" for="telInput">연락처</label>
                                        <input
                                                name="contact"
                                                type="tel"
                                                class="form-control m-input"
                                                id="telInput"
                                                required
                                                oninput="telHyphen(this)"
                                                pattern="[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}"
                                                maxlength="13"
                                                placeholder="예) 010-1234-5678"
                                        />
                                    </div>
                                    <div class="input-group mb-3">
                                        <label class="input-group-text" for="amount">₩</label>
                                        <input
                                                id="amount"
                                                name="amount"
                                                type="number"
                                                required
                                                pattern="^[0-9]+$"
                                                class="form-control"
                                                placeholder="예) 1000"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="row align-items-center mt-3 mb-3">
                                <div class="col">
                                    <label for="content" class="h3">상세내용</label>
                                    <div class="input-group">
                                        <textarea
                                                id="content"
                                                name="content"
                                                class="form-control"
                                                style="height: 400px"
                                                placeholder="상세내용"
                                        ></textarea>
                                    </div>
                                    <div class="d-grid mt-3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="modal_reset()" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                <button type="submit" form="modal-form" class="btn btn-primary">확인</button>
            </div>
        </div>
    </div>
</div>

<!-- image -->
<div class="mytitle"></div>

<!-- search -->
<div class="nav-search">
    <div class="search">
        <input class="search-input"
               id="searchKwd"
               type="search"
               placeholder="검색어를 입력하세요."
               aria-label="Search"
               onkeyup="if(window.event.keyCode===13){search_event()}"
        />
        <button class="search-button" type="button" onclick="search_event()">Search</button>
    </div>
</div>

<!-- content -->
<div class="mycards">
    <div class="row row-cols-1 row-cols-md-4 g-4" id="posts-box">
    </div>
</div>

</body>
</html>
